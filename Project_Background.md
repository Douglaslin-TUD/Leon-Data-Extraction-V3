# 项目背景介绍 - Leon Data Extraction

**创建日期：** 2025-11-05
**项目编号：** RWS-Leon-002
**最后更新：** 2025-11-05

---

## 1. 项目背景与目标

### 1.1 业务背景

**Leon** 是ICO（Informatie Centrum Onderhoud，信息中心维护部门）的数据专家，负责管理和整合RWS（Rijkswaterstaat，荷兰国家公路与水路管理局）的道路养护数据。

每年，RWS从多个**承包商（contractors）**收集道路养护工作的数据。这些数据以Excel表格的形式提交，但存在以下问题：

**主要痛点：**
1. **格式混乱**：每个承包商提交的Excel格式各不相同
2. **数据不统一**：字段名称、数据结构、单位不一致
3. **人工处理低效**：需要大量人工整理才能汇总分析
4. **质量难以保证**：手工操作容易出错，难以追溯

### 1.2 项目目标

开发一个**数据标准化软件**，实现：

✅ **自动提取**：从混乱的原始Excel文件中提取养护数据
✅ **格式统一**：将数据转换为标准化的统一格式
✅ **质量验证**：自动检查数据完整性和合理性
✅ **高效输出**：按照标准模板生成统一的数据统计表

---

## 2. 数据文件结构

### 2.1 目录组织

```
Leon_Data_Extraction/
├── Data/
│   └── FW_ /                           # 主数据文件夹（⚠️ 重要：不要修改RAW data）
│       ├── Template/                   # 标准模板文件夹
│       │   ├── Verzamelformulier_2021_v2.xlsx    # 2021年标准模板
│       │   └── Verzamelstaat_2022c.xlsx          # 2022年标准模板
│       │
│       └── Validator/                  # 原始数据和验证文件夹
│           ├── 2021/
│           │   └── Origineel/          # 2021年原始数据（12个文件）
│           │       ├── Formulier_2021 - uitvraag AB7 *.xlsx
│           │       ├── Lijst werkzaamheden WNN A Wegen 2021.xlsx
│           │       └── ... (共12个Excel文件)
│           │
│           └── 2022/
│               └── Origineel/          # 2022年原始数据（10个文件）
│                   ├── Formulier_2022 - uitvraag AB7 *.xlsx
│                   ├── Asfalt 2022 Zuid Nederland.xlsx
│                   └── ... (共10个Excel文件)
```

### 2.2 数据统计

| 年份 | 原始文件数量 | 模板文件 | 数据来源 |
|------|-------------|---------|---------|
| 2021 | 12个 | Verzamelformulier_2021_v2.xlsx | 多个区域承包商 |
| 2022 | 10个 | Verzamelstaat_2022c.xlsx | 多个区域承包商 |

### 2.3 承包商/区域标识

从文件名可以识别的数据来源区域：

**2021年数据来源：**
- **AB7** - 区域承包商AB7（多个分区）
- **MNZ** - Midden-Nederland Zuid（中荷兰南部）
- **MN-N-B** - Midden-Nederland Noord-B
- **ON-N** - Oost-Nederland Noord（东荷兰北部）
- **ON-Z** - Oost-Nederland Zuid（东荷兰南部）
- **ZN** - Zuid-Nederland（南荷兰）
- **WNN** - West-Nederland Noord（西荷兰北部）
- **WNZZ** - West-Nederland Zuid-Zuid
- **Zee en Delta** - 泽兰和三角洲地区

**2022年数据来源：**
- **AB7** - 区域承包商AB7
- **GO ON** - Groot Onderhoud Oost-Nederland
- **ON-Noord/Zuid** - 东荷兰北部/南部
- **ZN** - Zuid-Nederland
- **WNN** - West-Nederland Noord
- **NN-Oost** - 北荷兰东部
- **Zee en Delta** - 泽兰和三角洲地区

---

## 3. 业务数据类型

### 3.1 养护数据内容

原始数据主要记录**沥青路面养护工作（asfalterings werkzaamheden）**，包括：

- **路段信息**：公路编号、车行道、起止公里数
- **养护类型**：铺装类型、面层类型（deklagen）
- **工程量**：面积、厚度、材料用量
- **时间信息**：施工日期、计划日期
- **质量信息**：验收状态、检测结果
- **承包商信息**：责任单位、施工单位

### 3.2 关键术语

| 荷兰语 | 英文 | 中文 | 说明 |
|-------|------|------|------|
| Verzamelformulier | Collection form | 数据收集表 | 标准模板名称 |
| Verzamelstaat | Collection statement | 数据统计表 | 标准汇总表 |
| Origineel | Original | 原始数据 | 未处理的原始文件 |
| Uitvraag | Request/Query | 数据征集 | 向承包商征集数据 |
| Deklagen | Surface layers | 面层 | 路面表层 |
| LVO | Laatste Versie Opgeleverd | 最终交付版本 | 最终提交的数据 |
| Productiedashboard | Production dashboard | 生产看板 | 生产进度数据 |

---

## 4. 技术方案设计

### 4.1 数据处理流程

```
┌─────────────────┐
│  原始Excel文件   │  (多个承包商，格式混乱)
│  (Origineel)    │
└────────┬────────┘
         │
         ▼
┌─────────────────┐
│  数据提取模块    │  - 智能识别Excel结构
│  (Extraction)   │  - 提取标准化字段
└────────┬────────┘  - 格式清洗和转换
         │
         ▼
┌─────────────────┐
│  中间数据库      │  - SQLite/PostgreSQL
│  (Database)     │  - 标准化存储
└────────┬────────┘  - 数据版本管理
         │
         ▼
┌─────────────────┐
│  数据验证模块    │  - 完整性检查
│  (Validation)   │  - 合理性验证
└────────┬────────┘  - 异常值识别
         │
         ▼
┌─────────────────┐
│  报告生成模块    │  - 质量报告
│  (Reporting)    │  - 异常报告
└────────┬────────┘  - 统计分析
         │
         ▼
┌─────────────────┐
│  模板填充模块    │  - 按照Template格式
│  (Template)     │  - 生成标准Excel
└────────┬────────┘  - 自动排版
         │
         ▼
┌─────────────────┐
│  标准化Excel     │  (Verzamelformulier/Verzamelstaat)
│  (Output)       │
└─────────────────┘
```

### 4.2 技术栈建议

**编程语言：** Python 3.8+

**核心库：**
- `pandas` - 数据处理和分析
- `openpyxl` - Excel文件读写（支持格式和样式）
- `xlrd/xlwt` - 兼容老版本Excel
- `sqlalchemy` - 数据库ORM
- `pydantic` - 数据验证和schema定义

**数据库：**
- SQLite（开发/单机）或 PostgreSQL（生产环境）

**UI交互：**
- `streamlit` - 快速构建Web界面
- 或 `tkinter` - 桌面GUI应用

---

## 5. 关键约束和注意事项

### ⚠️ 重要规则

1. **不要修改原始数据（RAW Data）**
   - `Validator/2021/Origineel/` 和 `Validator/2022/Origineel/` 中的文件是原始数据
   - 只读取，不修改，不删除
   - 所有处理结果保存到其他目录

2. **保持欧洲数字格式**
   - 使用逗号作为小数分隔符：`1.234,56`
   - 不要转换为美式格式：`1,234.56`

3. **保留荷兰语术语**
   - 字段名称保持荷兰语（如Template所示）
   - 代码注释和变量名使用英文

4. **文件夹命名说明**
   - `FW_ ` 文件夹名称后有空格（原始命名，保持一致）

---

## 6. 项目阶段和任务

### 阶段1：背景知识建立 ✓
- [x] 理解项目目标和业务背景
- [x] 了解数据文件结构
- [ ] 学习RWS道路养护业务知识
- [ ] 掌握关键术语和数据含义

### 阶段2：数据结构分析
- [ ] 分析2021模板（Verzamelformulier_2021_v2.xlsx）结构
- [ ] 分析2022模板（Verzamelstaat_2022c.xlsx）结构
- [ ] 识别模板中的字段、格式、约束
- [ ] 对比2021和2022的差异

### 阶段3：原始数据探索
- [ ] 逐个分析2021年12个原始文件
- [ ] 逐个分析2022年10个原始文件
- [ ] 识别各文件的共同字段和特殊字段
- [ ] 记录数据质量问题（缺失、异常、格式错误）

### 阶段4：数据映射设计
- [ ] 建立原始数据字段 → 标准模板字段的映射关系
- [ ] 定义数据转换规则
- [ ] 设计数据库schema
- [ ] 设计验证规则和合理范围

### 阶段5：软件开发
- [ ] 搭建项目框架和数据库
- [ ] 开发数据提取模块
- [ ] 开发数据验证模块
- [ ] 开发模板生成模块
- [ ] 开发交互界面
- [ ] 开发报告生成功能

### 阶段6：测试和优化
- [ ] 使用2021数据测试
- [ ] 使用2022数据测试
- [ ] 修复bug和优化性能
- [ ] 生成测试报告

### 阶段7：交付和文档
- [ ] 编写用户手册
- [ ] 编写技术文档
- [ ] 准备演示和培训材料
- [ ] 交付给Leon团队

---

## 7. 数据质量要求

### 7.1 完整性要求
- 所有必填字段不能为空
- 公路编号必须符合RWS标准（RW xxx）
- 起止公里数必须完整

### 7.2 合理性要求
- 结束公里数 ≥ 起始公里数
- 施工面积 > 0
- 日期格式正确且逻辑合理
- 养护类型在允许的范围内

### 7.3 一致性要求
- 同一路段的数据不能冲突
- 数字格式统一（欧洲格式）
- 术语使用一致（参照标准词汇表）

---

## 8. 关键问题和风险

### 8.1 已知挑战

| 挑战 | 影响 | 应对策略 |
|------|------|---------|
| 原始Excel结构差异大 | 高 | 开发智能识别算法，必要时人工标注 |
| 数据质量参差不齐 | 中 | 建立多层验证机制，生成详细错误报告 |
| 模板可能逐年变化 | 中 | 设计可配置的映射系统，易于调整 |
| 业务规则不明确 | 高 | 需要与Leon密切沟通，迭代验证 |

### 8.2 待确认问题

1. **模板是否每年都变化？** 需要支持多少个版本？
2. **数据验证的具体规则是什么？** 哪些是硬性错误，哪些是警告？
3. **处理异常数据的策略？** 自动修正 vs 人工审核？
4. **输出格式要求？** 除了Excel，是否需要其他格式（CSV、数据库）？
5. **历史数据处理？** 是否需要处理2021、2022之前的数据？

---

## 9. 相关项目经验借鉴

### 9.1 姊妹项目：PDF to Excel - Harco

**位置：** `../PDF_to_Excel-Harco/code/`

**可复用的技术：**
- ✅ 数据验证框架
- ✅ 欧洲数字格式处理
- ✅ 质量评分系统
- ✅ Excel输出工具
- ✅ 错误报告生成

**技术文档：** 见 `../PDF_to_Excel-Harco/code/docs/CLAUDE.md`

---

## 10. 下一步行动

### 立即执行（本周）
1. ✅ 创建项目背景文档（本文档）
2. 📝 与Leon确认关键业务规则
3. 📖 详细阅读2021和2022模板文件
4. 🔍 分析1-2个原始文件作为样本

### 短期计划（2周内）
1. 完成所有原始文件的结构分析
2. 设计数据库schema
3. 开发数据提取原型
4. 测试1-2个文件的完整流程

### 中期目标（1个月内）
1. 完成核心功能开发
2. 完成2021和2022数据的处理
3. 交付可用版本给Leon测试

---

**文档维护：** 随着项目进展，持续更新本文档
**责任人：** 项目团队
**审核人：** Leon（ICO数据专家）
