{
  "metadata": {
    "version": "1.1",
    "template": "Verzamelstaat_2022c.xlsx",
    "created": "2025-11-05",
    "last_updated": "2025-11-05",
    "description": "Validation rules for 2022 template",
    "rule_categories": [
      "required_field",
      "data_type",
      "range",
      "format",
      "enum",
      "conditional_required",
      "cross_field_logic",
      "calculated_field",
      "reference_data"
    ],
    "domain_concepts": {
      "oriëntatierichting": {
        "name_nl": "Oriëntatierichting",
        "name_en": "Road Standard Direction",
        "name_cn": "道路标准方向",
        "definition": "每条道路有一个官方定义的参考方向（oriëntatierichting），类似于河流的'上游→下游'方向。这是道路的'正方向'，用于统一整个道路网络的公里标系统。",
        "purpose": {
          "main": "确保道路位置标识的一致性和唯一性",
          "functions": [
            "定义公里标的递增方向",
            "确定车道的顺向/逆向关系",
            "统一整个国家道路网络的位置参照系统"
          ]
        },
        "how_it_works": {
          "standard_direction": "道路标准方向由RWS官方定义，对每条道路是固定的",
          "kilometer_markers": "沿着oriëntatierichting方向，公里标数值递增（0 → 50 → 100 → ...）",
          "opposite_direction": "逆着oriëntatierichting方向，公里标数值递减（... → 100 → 50 → 0）",
          "bidirectional_roads": "双向道路上，右侧车道（1HRR）沿标准方向，左侧车道（1HRL）逆标准方向"
        },
        "relationship_with_baan": {
          "description": "BAAN字段类型决定了该车道是顺向还是逆向行驶",
          "with_orientation": {
            "baan_types": ["1HRR", "0HRM", "0VW"],
            "direction": "沿oriëntatierichting（WITH）- 顺向",
            "van_tot_relationship": "TOT > VAN（公里标递增）",
            "percentage": "55.5%的数据（883行）"
          },
          "against_orientation": {
            "baan_types": ["1HRL", "PWL"],
            "direction": "逆oriëntatierichting（AGAINST）- 逆向",
            "van_tot_relationship": "VAN > TOT（公里标递减）",
            "percentage": "44.5%的数据（709行）"
          }
        },
        "real_world_example": {
          "road": "A12高速公路（Den Haag → Utrecht → Arnhem → Duitsland）",
          "oriëntatierichting": "从西向东（Den Haag → Duitsland）",
          "right_carriageway_1HRR": {
            "direction": "向东行驶（Den Haag → Utrecht）",
            "orientation": "沿oriëntatierichting（WITH）",
            "kilometer_markers": "VAN=50 → TOT=80（Den Haag → Utrecht段）",
            "result": "TOT > VAN"
          },
          "left_carriageway_1HRL": {
            "direction": "向西行驶（Utrecht → Den Haag）",
            "orientation": "逆oriëntatierichting（AGAINST）",
            "kilometer_markers": "VAN=80 → TOT=50（Utrecht → Den Haag段）",
            "result": "VAN > TOT",
            "note": "同一物理位置，但方向相反，公里标递减"
          }
        },
        "impact_on_data_validation": {
          "critical_correction": {
            "old_assumption": "所有数据都应满足TOT >= VAN",
            "correct_understanding": "VAN/TOT关系由BAAN的oriëntatierichting决定",
            "impact": "44.5%的数据（709行）VAN > TOT是完全正常的，不是错误",
            "related_rules": ["CROSS-VAN-TOT-DIRECTION", "CALC-001"]
          },
          "fields_affected": {
            "VAN": "起始公里标位置（kilometer）",
            "TOT": "结束公里标位置（kilometer）",
            "KM_Van": "与VAN相同（冗余字段）",
            "KM_Tot": "与TOT相同（冗余字段）",
            "Lengte": "路段长度 = abs(TOT - VAN)，永远为正"
          }
        },
        "terminology_clarification": {
          "not_start_end": "VAN/TOT不是'起点/终点'（start/end point），而是'起始公里标/结束公里标'（from kilometer / to kilometer）",
          "location_based": "公里标是位置标识，不是距离测量",
          "direction_dependent": "公里标的递增/递减方向取决于行驶方向与oriëntatierichting的关系"
        },
        "references": {
          "source": "Template_2022_Complete_Field_Reference.md 字段7-8详细分析",
          "bps_documentation": "BPS (Beheer- en Planningssysteem) 道路系统文档",
          "rws_standards": "RWS道路网络位置标识系统",
          "data_evidence": "1,592行2022年实际数据验证"
        },
        "date_added": "2025-11-05",
        "importance": "CRITICAL - 理解此概念是正确验证VAN/TOT字段的前提"
      }
    }
  },
  "rules": [
    {
      "rule_id": "REQ-001",
      "category": "required_field",
      "enabled": true,
      "field": "Weg",
      "description": "道路编号必填",
      "validation": {
        "type": "not_null"
      },
      "error_message": "字段'Weg'不能为空",
      "severity": "error"
    },
    {
      "rule_id": "ENUM-001",
      "category": "enum",
      "enabled": true,
      "field": "BAAN",
      "description": "车道类型必须在标准BPS值列表中",
      "validation": {
        "type": "in_list",
        "allowed_values": ["1HRR", "1HRL", "0HRM", "0VW", "PWL"]
      },
      "error_message": "字段'BAAN'值'{value}'不在允许列表中。有效值: 1HRR, 1HRL, 0HRM, 0VW, PWL",
      "severity": "error",
      "source": "Leon确认 + BPS官方文档 + RWS geo服务",
      "baan_definitions": {
        "1HRR": {
          "full_name": "Hoofdrijbaan Rechts",
          "en": "Right main carriageway",
          "cn": "右侧主车道",
          "structure": "1(volgnummer) + HR(baansoort) + R(baanpositie)",
          "source": "Leon确认"
        },
        "1HRL": {
          "full_name": "Hoofdrijbaan Links",
          "en": "Left main carriageway",
          "cn": "左侧主车道",
          "structure": "1(volgnummer) + HR(baansoort) + L(baanpositie)",
          "source": "Leon确认"
        },
        "0HRM": {
          "full_name": "Hoofdrijbaan Midden",
          "en": "Middle main carriageway",
          "cn": "中间主车道",
          "structure": "0(volgnummer) + HR(baansoort) + M(baanpositie)",
          "special_rule": "双向，必须同时有1R-R和1R-L",
          "source": "Leon确认"
        },
        "0VW": {
          "full_name": "Verbindingsweg",
          "en": "Connecting road/ramp",
          "cn": "连接道/匝道",
          "structure": "0(volgnummer) + VW(baansoort)",
          "special_rule": "需要WEGLET字段",
          "source": "Leon确认"
        },
        "PWL": {
          "full_name": "Parallelweg Links",
          "en": "Left parallel road",
          "cn": "左侧平行路",
          "structure": "(1默认)(volgnummer) + PW(baansoort) + L(baanpositie)",
          "explanation": "Parallelweg是与主路平行的辅道/平行车道",
          "source": "RWS geo服务 + BPS文档",
          "references": [
            "https://geo.rijkswaterstaat.nl/arcgis/rest/services/GDR/bps_kaart/MapServer/9",
            "RWS Productspecificatie Ultimo (2014)",
            "NDW NWB基础结构文档"
          ]
        }
      },
      "baan_structure_explanation": {
        "pattern": "[baanvolgnummer] + [baansoort] + [baanpositie]",
        "components": {
          "baanvolgnummer": {
            "description": "车道序号",
            "values": {
              "0": "连接道/特殊道或无并行关系",
              "1": "第一条主车道",
              "2": "第二条主车道（如果存在）"
            }
          },
          "baansoort": {
            "description": "车道类型",
            "values": {
              "HR": "Hoofdrijbaan (主车道)",
              "VW": "Verbindingsweg (连接道)",
              "PW": "Parallelweg (平行路)"
            }
          },
          "baanpositie": {
            "description": "相对于WOL的位置",
            "values": {
              "L": "Links (左侧)",
              "R": "Rechts (右侧)",
              "M": "Midden (中间)",
              "(空)": "不适用（如VW）"
            }
          }
        },
        "examples": {
          "1HRR": "第1条主车道，右侧",
          "1HRL": "第1条主车道，左侧",
          "0HRM": "主车道，中间位置",
          "0VW": "连接道（无左右位置）",
          "PWL": "平行路，左侧（默认第1条）"
        }
      },
      "data_quality_notes": {
        "PWL_frequency": "数据中出现4次（0.25%）",
        "1HRR_HRR_error": "数据中可能出现'1HRR+HRR'格式，应标准化为'1HRR'"
      }
    },
    {
      "rule_id": "RANGE-001",
      "category": "range",
      "enabled": true,
      "field": "DIKTE VERHARDING",
      "description": "路面厚度应在合理范围内",
      "validation": {
        "type": "numeric_range",
        "min": 0.020,
        "max": 0.150,
        "unit": "meter"
      },
      "error_message": "字段'DIKTE VERHARDING'值{value}超出范围[0.020, 0.150]米",
      "severity": "warning"
    },
    {
      "rule_id": "COND-001",
      "category": "conditional_required",
      "enabled": true,
      "description": "当STROOK=ALL时，Aantal rijstroken必填",
      "validation": {
        "type": "conditional_required",
        "condition": {
          "field": "STROOK",
          "operator": "equals",
          "value": "ALL"
        },
        "then": {
          "field": "Aantal rijstroken",
          "required": true
        }
      },
      "error_message": "当STROOK='ALL'时，'Aantal rijstroken'不能为空",
      "severity": "error"
    },
    {
      "rule_id": "CROSS-001",
      "category": "cross_field_logic",
      "enabled": false,
      "description": "【已弃用】TOT必须大于等于VAN",
      "validation": {
        "type": "comparison",
        "field1": "TOT",
        "operator": ">=",
        "field2": "VAN"
      },
      "error_message": "TOT({value1})必须大于等于VAN({value2})",
      "severity": "error",
      "deprecation_reason": "此规则基于错误假设。VAN > TOT在44.5%数据中是正常现象（1HRL, PWL等逆向车道）",
      "replaced_by": "CROSS-VAN-TOT-DIRECTION",
      "data_evidence": "709行（44.5%）的数据中VAN > TOT，这些都是有效数据",
      "corrected_understanding": "VAN/TOT的大小关系由BAAN的oriëntatierichting决定",
      "date_deprecated": "2025-11-05"
    },
    {
      "rule_id": "CROSS-VAN-TOT-DIRECTION",
      "category": "cross_field_logic",
      "enabled": true,
      "description": "验证VAN和TOT的方向关系是否符合BAAN类型的oriëntatierichting（道路标准方向）",
      "validation": {
        "type": "directional_logic",
        "fields": ["VAN", "TOT", "BAAN"],
        "direction_rules": {
          "with_orientation": {
            "baan_types": ["1HRR", "0HRM", "0VW"],
            "expected_relationship": "TOT > VAN",
            "description": "顺向车道（沿oriëntatierichting行驶），公里标递增",
            "data_percentage": "55.5%（883行）"
          },
          "against_orientation": {
            "baan_types": ["1HRL", "PWL"],
            "expected_relationship": "VAN > TOT",
            "description": "逆向车道（逆oriëntatierichting行驶），公里标递减",
            "data_percentage": "44.5%（709行）"
          }
        }
      },
      "error_message": "BAAN '{baan}' 的方向关系错误：{direction_type}应满足{expected}，但实际VAN={van} TOT={tot}",
      "severity": "error",
      "conceptual_explanation": {
        "oriëntatierichting": {
          "definition": "道路标准方向（Road standard direction）- 每条道路有一个官方定义的参考方向",
          "purpose": "统一整个道路网络的公里标系统，确保位置标识的一致性",
          "analogy": "类似于河流的'上游→下游'方向，是道路的'正方向'"
        },
        "baan_direction_relationship": {
          "1HRR": {
            "full_name": "Hoofdrijbaan Rechts（右侧主车道）",
            "orientation": "沿oriëntatierichting（WITH）",
            "logic": "右侧主车道顺着道路标准方向行驶",
            "van_tot": "TOT > VAN（公里标递增）",
            "example": "VAN=10.5 → TOT=12.3（向前行驶2.8公里）"
          },
          "1HRL": {
            "full_name": "Hoofdrijbaan Links（左侧主车道）",
            "orientation": "逆oriëntatierichting（AGAINST）",
            "logic": "左侧主车道逆着道路标准方向行驶（对向交通）",
            "van_tot": "VAN > TOT（公里标递减）",
            "example": "VAN=12.3 → TOT=10.5（逆向行驶2.8公里）"
          },
          "0HRM": {
            "full_name": "Hoofdrijbaan Midden（中间主车道）",
            "orientation": "沿oriëntatierichting（WITH）- 默认取右向",
            "logic": "双向车道，但记录时以右向为准",
            "van_tot": "TOT > VAN",
            "note": "虽然包含双向交通，但路段定义遵循标准方向"
          },
          "0VW": {
            "full_name": "Verbindingsweg（连接道/匝道）",
            "orientation": "沿oriëntatierichting（WITH）",
            "logic": "匝道通常遵循主路的标准方向系统",
            "van_tot": "TOT > VAN",
            "note": "匝道的方向由其连接的主路决定"
          },
          "PWL": {
            "full_name": "Parallelweg Links（左侧平行路）",
            "orientation": "逆oriëntatierichting（AGAINST）",
            "logic": "与左侧主车道同向，逆标准方向",
            "van_tot": "VAN > TOT",
            "example": "平行于1HRL的辅道，同样逆向行驶"
          }
        },
        "why_this_matters": {
          "data_integrity": "44.5%的数据（709行）VAN > TOT是完全正常的，不是错误",
          "location_system": "VAN/TOT不是'起点/终点'，而是'起始公里标/结束公里标'",
          "bidirectional_roads": "双向道路上，左右车道的VAN/TOT关系完全相反"
        }
      },
      "validation_logic": {
        "step1": "检查BAAN类型",
        "step2": "确定该BAAN的oriëntatierichting（WITH或AGAINST）",
        "step3": "验证VAN/TOT关系是否符合预期",
        "step4_with": "如果WITH方向 → 检查 TOT > VAN",
        "step4_against": "如果AGAINST方向 → 检查 VAN > TOT"
      },
      "implementation_pseudocode": {
        "code": [
          "if BAAN in ['1HRR', '0HRM', '0VW']:",
          "    # 顺向车道，期望公里标递增",
          "    if not (TOT > VAN):",
          "        raise Error('顺向车道应满足 TOT > VAN')",
          "",
          "elif BAAN in ['1HRL', 'PWL']:",
          "    # 逆向车道，期望公里标递减",
          "    if not (VAN > TOT):",
          "        raise Error('逆向车道应满足 VAN > TOT')",
          "",
          "else:",
          "    # 未知BAAN类型，跳过验证",
          "    pass"
        ]
      },
      "data_evidence": {
        "total_rows": 1592,
        "tot_gt_van": {
          "count": 883,
          "percentage": 55.5,
          "baan_distribution": {
            "1HRR": "占大多数",
            "0HRM": "少量",
            "0VW": "少量"
          }
        },
        "van_gt_tot": {
          "count": 709,
          "percentage": 44.5,
          "baan_distribution": {
            "1HRL": "占大多数",
            "PWL": "4行（0.25%）"
          }
        },
        "conclusion": "数据完美符合BAAN方向规则，两种关系都是正常的"
      },
      "source": "Template_2022_Complete_Field_Reference.md 字段7-8分析 + 荷兰道路系统oriëntatierichting概念",
      "replaces": "CROSS-001（已弃用）",
      "date_added": "2025-11-05"
    },
    {
      "rule_id": "RANGE-VAN-TOT",
      "category": "range",
      "enabled": true,
      "description": "检测VAN和TOT值的异常范围（应在合理的公里标范围内）",
      "validation": {
        "type": "numeric_range",
        "fields": ["VAN", "TOT"],
        "normal_range": {
          "min": -50.0,
          "max": 600.0,
          "unit": "kilometer",
          "description": "荷兰国家高速公路公里标的正常范围"
        },
        "anomaly_detection": {
          "extreme_values": {
            "threshold": 1000.0,
            "description": "公里标值超过1000可能是数据错误"
          },
          "negative_values": {
            "min": -50.0,
            "description": "负值允许（起点前路段），但不应小于-50"
          }
        }
      },
      "error_message": "字段'{field}'值{value} km超出正常范围[{min}, {max}] km，请确认数据正确性",
      "severity": "warning",
      "data_evidence": {
        "van_range": {
          "min": -13.7,
          "max": 54350.0,
          "description": "VAN字段实际范围",
          "anomaly": "最大值54350.0明显异常（应为543.50或54.350?）"
        },
        "tot_range": {
          "min": -13.6,
          "max": 54350.1,
          "description": "TOT字段实际范围",
          "anomaly": "最大值54350.1明显异常"
        },
        "normal_percentile": {
          "p99_van": "约180 km（99%数据的上限）",
          "p99_tot": "约180 km",
          "conclusion": "99%的数据在合理范围内，超大值是离群点"
        }
      },
      "special_cases": {
        "negative_kilometers": {
          "valid": true,
          "explanation": "负值公里标是合法的，表示道路起点之前的路段（如连接段、匝道起点）",
          "example": "VAN=-13.7表示在道路0公里标之前13.7公里处",
          "min_allowed": -50.0,
          "reason": "超过-50的负值可能是数据错误"
        },
        "very_large_values": {
          "threshold": 600.0,
          "explanation": "荷兰最长国家高速公路A12约180km，A2约185km。超过600的值极可能是错误",
          "suspected_errors": {
            "54350.0": {
              "possible_cause": "单位错误或小数点位置错误",
              "corrections": [
                "543.50 km（小数点错误）",
                "54.350 km（单位错误：从米转换时错误）",
                "543 hm = 54.3 km（单位混淆）"
              ]
            }
          }
        }
      },
      "implementation_logic": {
        "step1": "检查VAN值是否在[-50, 600]范围内",
        "step2": "检查TOT值是否在[-50, 600]范围内",
        "step3": "如果超出范围，生成警告",
        "step4": "如果超过1000，生成严重警告（极可能是错误）"
      },
      "source": "Template_2022_Complete_Field_Reference.md 字段7-8数据统计 + 荷兰道路网络实际长度",
      "references": {
        "dutch_highway_lengths": "A12≈180km, A2≈185km（最长的国家高速公路）",
        "data_analysis": "1,592行数据中发现VAN/TOT最大值54350.0（明显异常）"
      },
      "date_added": "2025-11-05"
    },
    {
      "rule_id": "CALC-001",
      "category": "calculated_field",
      "enabled": true,
      "description": "Lengte应该等于abs(TOT - VAN)，单位为公里",
      "validation": {
        "type": "calculated_value",
        "target_field": "Lengte",
        "formula": "abs(TOT - VAN)",
        "tolerance": 0.001,
        "result_unit": "kilometer"
      },
      "error_message": "Lengte({actual} km)与计算值({expected} km)不匹配（容差0.001 km）",
      "severity": "warning",
      "explanation": {
        "formula": "abs(TOT - VAN)",
        "always_positive": true,
        "reason": "使用绝对值确保长度永远为正，无论VAN和TOT的大小关系",
        "unit_note": "VAN/TOT/Lengte单位都是公里(km)"
      },
      "critical_correction": {
        "date": "2025-11-05",
        "old_formula": "(TOT - VAN) * 100（错误）",
        "correct_formula": "abs(TOT - VAN)",
        "old_unit": "meter",
        "correct_unit": "kilometer"
      }
    },
    {
      "rule_id": "FORMAT-001",
      "category": "format",
      "enabled": true,
      "field": "STROOK",
      "description": "车道编号格式验证",
      "validation": {
        "type": "regex",
        "pattern": "^(\\d{1}[RWUIQBV]-[LR]|ALL|\\d{1}[RWUIQBV]-[LR],\\s*\\d{1}[RWUIQBV]-[LR])$"
      },
      "error_message": "字段'STROOK'格式不正确: {value}",
      "severity": "warning"
    },
    {
      "rule_id": "FORMAT-002",
      "category": "format",
      "enabled": true,
      "field": "Weg",
      "description": "国家高速公路编号格式验证和标准化（A和RW等价，自动去前导零）",
      "validation": {
        "type": "regex",
        "pattern": "^(\\d{1,3}|A\\d{1,3}|RW\\d{1,4})$",
        "normalization": {
          "enabled": true,
          "description": "输入 → 存储 → 输出三阶段处理",
          "storage_format": "A{number}",
          "output_format": "{number}",
          "strip_prefixes": ["RW", "A"],
          "remove_leading_zeros": true,
          "add_prefix_for_storage": "A"
        }
      },
      "error_message": "字段'Weg'格式不正确: {value}。有效格式: 1, A1, RW1, RW001（国家高速公路）",
      "severity": "error",
      "data_flow": {
        "input": "承包商提交的多种格式（1, A1, RW1, RW001, RW021等）",
        "storage": "数据库统一存储为A{数字}格式（A1, A21, A200）- 无前导零",
        "output": "Excel输出为纯数字（1, 21, 200）- Number类型"
      },
      "examples": {
        "valid_inputs": ["1", "21", "28", "200", "A1", "A21", "A28", "RW1", "RW001", "RW21", "RW021", "RW28"],
        "invalid_inputs": ["ABC", "A", "RW", "0", "1000", "N200", "A0", "RW0"],
        "normalization_flow": {
          "input_1": {"input": "1", "storage": "A1", "excel_output": 1},
          "input_A1": {"input": "A1", "storage": "A1", "excel_output": 1},
          "input_RW001": {"input": "RW001", "storage": "A1", "excel_output": 1},
          "input_21": {"input": "21", "storage": "A21", "excel_output": 21},
          "input_RW021": {"input": "RW021", "storage": "A21", "excel_output": 21},
          "input_A28": {"input": "A28", "storage": "A28", "excel_output": 28},
          "input_200": {"input": "200", "storage": "A200", "excel_output": 200}
        }
      },
      "implementation_notes": {
        "step1_input_validation": "验证输入格式是否符合正则表达式",
        "step2_normalization": "去掉A/RW前缀 → 转int去前导零 → 加A前缀",
        "step3_storage": "存储到数据库: VARCHAR(6) 存储 A1, A21, A28...",
        "step4_output": "Excel导出: 去掉A前缀 → 转换为int → 输出数字类型",
        "code_example": "normalize: int(re.sub(r'^(A|RW)', '', value)) → f'A{num}' → output: int(storage.replace('A', ''))"
      }
    },
    {
      "rule_id": "FORMAT-003",
      "category": "format",
      "enabled": true,
      "field": "Weg",
      "description": "检测省道N路（不应出现在国家高速公路数据中）",
      "validation": {
        "type": "regex",
        "pattern": "^N\\d{1,3}$",
        "should_not_match": true
      },
      "error_message": "字段'Weg'包含省道编号'{value}'。省道(N路)不属于RWS国家高速公路管辖范围，请确认数据正确性",
      "severity": "warning",
      "note": "N道路是省道，不是国家高速公路（A/RW）"
    },
    {
      "rule_id": "ENUM-002",
      "category": "enum",
      "enabled": true,
      "field": "WEGLET",
      "description": "WEGLET必须是a/b/c/d字母编码",
      "validation": {
        "type": "in_list",
        "allowed_values": ["a", "b", "c", "d"]
      },
      "error_message": "字段'WEGLET'值'{value}'不在允许列表中。有效值: a=下匝道顺向, b=上匝道顺向, c=下匝道逆向, d=上匝道逆向",
      "severity": "error",
      "source": "BPS_boek_concept.pdf Tabel 3",
      "examples": {
        "a": "afrit oplopend (下匝道-顺向)",
        "b": "toerit oplopend (上匝道-顺向)",
        "c": "afrit aflopend (下匝道-逆向)",
        "d": "toerit aflopend (上匝道-逆向)"
      }
    },
    {
      "rule_id": "COND-002",
      "category": "conditional_required",
      "enabled": true,
      "description": "当BAAN=0VW时，WEGLET必填",
      "validation": {
        "type": "conditional_required",
        "condition": {
          "field": "BAAN",
          "operator": "equals",
          "value": "0VW"
        },
        "then": {
          "field": "WEGLET",
          "required": true
        }
      },
      "error_message": "当BAAN='0VW'（连接道）时，'WEGLET'不能为空",
      "severity": "error",
      "note": "0VW类型必须指定匝道字母编码（a/b/c/d）"
    },
    {
      "rule_id": "CROSS-002",
      "category": "cross_field_logic",
      "enabled": true,
      "description": "STROOK后缀-R只能出现在BAAN=1HRR/0HRM/0VW",
      "validation": {
        "type": "conditional_pattern_match",
        "if": {
          "field": "STROOK",
          "pattern": ".*-R$"
        },
        "then": {
          "field": "BAAN",
          "must_be_in": ["1HRR", "0HRM", "0VW"]
        }
      },
      "error_message": "STROOK '{value1}' 后缀为-R（右向），但BAAN '{value2}' 不是右侧或中间车道。-R只能出现在1HRR/0HRM/0VW",
      "severity": "error",
      "source": "Leon说明 + BPS逻辑"
    },
    {
      "rule_id": "CROSS-003",
      "category": "cross_field_logic",
      "enabled": true,
      "description": "STROOK后缀-L只能出现在BAAN=1HRL/0HRM/0VW",
      "validation": {
        "type": "conditional_pattern_match",
        "if": {
          "field": "STROOK",
          "pattern": ".*-L$"
        },
        "then": {
          "field": "BAAN",
          "must_be_in": ["1HRL", "0HRM", "0VW"]
        }
      },
      "error_message": "STROOK '{value1}' 后缀为-L（左向），但BAAN '{value2}' 不是左侧或中间车道。-L只能出现在1HRL/0HRM/0VW",
      "severity": "error",
      "source": "Leon说明 + BPS逻辑"
    },
    {
      "rule_id": "CROSS-004",
      "category": "cross_field_logic",
      "enabled": false,
      "description": "Q-R类型（外侧高峰车道）只能出现在右侧或中间车道",
      "validation": {
        "type": "conditional_pattern_match",
        "if": {
          "field": "STROOK",
          "pattern": "^[12]Q-R$"
        },
        "then": {
          "field": "BAAN",
          "must_be_in": ["1HRR", "0HRM", "0VW"]
        }
      },
      "error_message": "Spitsstroken (Q-车道) 总在右侧，STROOK '{value1}' 只能出现在BAAN=1HRR/0HRM/0VW",
      "severity": "warning",
      "note": "Leon说明：Q车道总在右侧。但需要确认数据中是否有1Q-L/2Q-L",
      "source": "Hallo Peng Luuk.txt"
    },
    {
      "rule_id": "DATA-001",
      "category": "data_quality",
      "enabled": false,
      "description": "V-类型（应急车道）编号异常检测",
      "validation": {
        "type": "pattern_match",
        "field": "STROOK",
        "pattern": "^[12]V-[LR]$",
        "should_not_match": true
      },
      "error_message": "STROOK '{value}' 包含编号应急车道（1V/2V），BPS定义V-为应急车道，通常不应有编号。请确认数据正确性",
      "severity": "warning",
      "note": "待Leon确认：1V-L, 1V-R, 2V-R是否为有效值",
      "source": "BPS_boek_concept.pdf vs 实际数据差异"
    },
    {
      "rule_id": "CROSS-005",
      "category": "cross_field_logic",
      "enabled": true,
      "description": "0HRM中间车道必须同时包含1R-R和1R-L车道",
      "validation": {
        "type": "group_validation",
        "scope": "same_road_section",
        "grouping_fields": ["Weg", "BAAN", "VAN", "TOT"],
        "if": {
          "field": "BAAN",
          "operator": "equals",
          "value": "0HRM"
        },
        "then": {
          "field": "STROOK",
          "must_contain_both": ["1R-R", "1R-L"],
          "description": "在同一路段（Weg+VAN+TOT相同）内，必须同时出现1R-R和1R-L"
        }
      },
      "error_message": "BAAN='0HRM'（中间车道）时，必须同时包含1R-R（右向第1车道）和1R-L（左向第1车道）。当前路段缺少必要车道",
      "severity": "error",
      "source": "Leon说明 - A 0HRM carriage way consists of one 1R-R and one 1R-L lane",
      "logic_explanation": {
        "0HRM_definition": "中间车道（Hoofdrijbaan Midden）同时容纳双向交通",
        "minimum_requirement": "至少包含1R-R（右向）和1R-L（左向）各一条",
        "optional_lanes": "可能还包含uitvoegstroken (1U-R, 2U-R, 1U-L, 2U-L) 和 invoegstroken (1I-R, 2I-R, 1I-L, 2I-L)",
        "typical_location": "交叉路口（Kruising）或铁路道口（Spoorwegkruising）"
      },
      "implementation_note": "此规则需要分组验证，在同一路段内检查STROOK字段的所有值"
    }
  ],
  "rule_groups": {
    "critical_validations": ["REQ-001", "ENUM-001", "ENUM-002", "CROSS-VAN-TOT-DIRECTION", "CROSS-002", "CROSS-003", "CROSS-005"],
    "data_quality_checks": ["RANGE-001", "RANGE-VAN-TOT", "CALC-001", "FORMAT-001", "DATA-001"],
    "conditional_rules": ["COND-001", "COND-002"],
    "format_rules": ["FORMAT-001", "FORMAT-002", "FORMAT-003"],
    "baan_strook_logic": ["CROSS-002", "CROSS-003", "CROSS-004", "CROSS-005"],
    "weglet_rules": ["ENUM-002", "COND-002"],
    "directional_logic": ["CROSS-VAN-TOT-DIRECTION"],
    "range_checks": ["RANGE-001", "RANGE-VAN-TOT"]
  },
  "notes": {
    "how_to_add_rules": "按照上述示例格式添加新规则",
    "rule_execution_order": "按照rules数组顺序执行",
    "severity_levels": "error=阻止导入, warning=记录但允许, info=仅提示"
  }
}
